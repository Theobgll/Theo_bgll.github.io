<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin – Live Camera</title>
</head>
<body>

<h2>Caméra utilisateur (temps réel)</h2>
<video id="remoteVideo" autoplay playsinline></video>

<script>
  const video = document.getElementById('remoteVideo');

  let pc = null;

  const socket = new WebSocket('wss://theo-bgll-github-io.onrender.com');

  socket.onopen = () => {
    console.log("WebSocket connecté (admin)");
    socket.send(JSON.stringify({ type: 'admin-ready' }));
  };

  socket.onmessage = async (msg) => {
    if (typeof msg.data !== "string") return; // ignore blobs

    const data = JSON.parse(msg.data);

    if (data.type === 'offer') {
      pc = new RTCPeerConnection();

      pc.ontrack = (event) => {
        video.srcObject = event.streams[0];
      };

      pc.onicecandidate = e => {
        if (e.candidate) {
          socket.send(JSON.stringify({ type:'candidate', candidate:e.candidate }));
        }
      };

      await pc.setRemoteDescription(data.offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      socket.send(JSON.stringify({ type: 'answer', answer }));
    }

    if (data.type === 'candidate') {
      if (pc) {
        await pc.addIceCandidate(data.candidate);
      }
    }
  };
</script>

</body>
</html>
